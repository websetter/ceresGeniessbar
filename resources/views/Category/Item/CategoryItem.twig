{% extends getPartial('page-design') %}
{% import "Ceres::Category.Macros.CategoryTree" as Tree %}
{% import "Ceres::PageDesign.Macros.LayoutContainer" as LayoutContainer %}

{% block PageBody %}

    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterList") }}
    {{ component( "Ceres::ItemList.Components.Filter.ItemFilterTagList") }}
    {{ component( "GeniessBar::ItemList.Components.ItemList") }}
    {{ component( "Ceres::ItemList.Components.CategoryImageCarousel") }}
    {{ component( "GeniessBar::ItemList.Components.ItemListSorting") }}
    {{ component( "Ceres::ItemList.Components.ItemsPerPage") }}
    {{ component( "Ceres::ItemList.Components.Pagination") }}
    {{ component( "GeniessBar::ItemList.Components.CategoryItem" ) }}

    {% set shippingCat = config("Ceres.global.shippingCostsCategoryId") %}

<div class="container">
  <div class="catMenu">
    <div id="menuKacheln" class="row">
      <div class="col-xs-12 col-sm-3 col-md-5">
        {% set lastCategory = categoryBreadcrumbs | last %}
        {% if lastCategory.details is defined %}
            <div class="kachelBig"><img src="/documents/{{ lastCategory.details[0].image2Path }}" /></div>
        {% else %}
            <div class="kachelBig" v-cloak v-if="$store.state.item.variation.documents">
                <img src="/documents/${ $store.state.item.variation.documents[0].data | image2Path }" />
            </div>
        {% endif %}
      </div>
      <div class="col-xs-12 col-sm-9 col-md-7">

        {% for category in categories %}
          <div class="kachel">
              <a href="{{ category.details[0].nameUrl }}">
                {% if category.details[0].image2Path is not empty %}
                  <img src="/documents/{{ category.details[0].image2Path }}" />
                  {% else %}
                  <p>{{ category.details[0].name }}</p>
                  {% endif %}
            </a>
          </div>
        {% endfor %}
    </div>
  </div>
</div>
  <div class="row">
    <div class="col-xs-12 categoriegrid page-content categoryItem cat-id-{{ category.id}}">
      <h1 class="category-title">{{ category.details[0].name }}</h1>
      <div id="category-description-container" class="category-description">{{ category.details[0].description | raw }}</div>
      <div class="row">
        <div class="col-xs-12 col-sm-3">
          <div class="sorting">
            <item-list-sorting template="#vue-item-list-sorting" :sorting-list="{{ searchOptions.sorting | json_encode }}" :default-sorting="{{ searchOptions.defaultSorting | json_encode }}"></item-list-sorting>
            <items-per-page template="#vue-items-per-page" :pagination-values="{{ searchOptions.itemsPerPage | json_encode }}"></items-per-page>
          </div>
          {% if ceresConfig.pagination.position in ['top', 'top_bottom'] %}
            <div class="pagination">
                <div class="col-xs-12">
                    <pagination template="#vue-pagination"></pagination>
                    <noscript>
                        {% include "Ceres::Category.Item.Partials.Pagination" %}
                    </noscript>
                </div>
            </div>
        {% endif %}
        </div>
        <div class="col-xs-12 col-sm-9 childCat">
          <div class="row">
          {% set childCat = services.category.getChildren(category.id, lang) %}
          {% for child in childCat %}
            <div class="kachel col-xs-12 col-sm-3">
              <a href="{{category.details[0].nameUrl}}/{{ child.details[0].nameUrl }}">
                <p>{{ child.details[0].name }} </p>
              </a>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>

      <div id="twig-rendered-item-list" class="item-list-frame{% if ceresConfig.item.loadingAnimationType == "blur" %} blur-effect{% endif %}">
        {% if ceresConfig.item.loadingAnimationType != "blur" %}
            {% include "Ceres::ItemList.Partials.LoadingAnimation" %}
        {% endif %}
        <ul class="product-list row grid" v-is-loading-watcher="$store.state.itemList.isLoading">
          {% for item in itemList %}
            <li class="col-xs-12 col-sm-6 col-md-3 col-lg-3">
              {% include "GeniessBar::Category.Item.Partials.CategoryListItem" with { 'item': item, 'shippingCat': shippingCat } %}
            </li>
          {% endfor %}
        </ul>
      </div>
      <div id="vue-rendered-item-list" style="display:none">
          <item-list template="#vue-item-list" :total-items-data="{{ itemCountTotal }}" :category-id="{{ category.id }}"></item-list>
      </div>
      <div id="category-description-container2" class="category-description">{{ category.details[0].description2 | raw }}</div>
    </div>
    <div class="col-xs-7 vat">
        <p>* Alle Preise inkl. ges. MwSt. zzgl. <a href="/bestellvorgang/versand-und-kosten/" title="">Versankosten</a></p>
    </div>
    <div class="col-xs-5">
        {% if ceresConfig.pagination.position in ['bottom', 'top_bottom'] %}
            <div class="list-controls m-b-3 row">
                <div class="col-xs-12">
                    <pagination template="#vue-pagination"></pagination>
                    <noscript>
                        {% include "Ceres::Category.Item.Partials.Pagination" %}
                    </noscript>
                </div>
            </div>
        {% endif %}
    </div>
  </div>
</div>
{% endblock %}

{% block PartialHead %}
    <script type="application/ld+json">{"@context": "http://schema.org","@type": "WebSite","url": "{{ webstoreConfig.domainSsl }}","potentialAction":{"@type": "SearchAction","target": "{{ domainSsl }}/search?query={search_term}","query-input": "required name=search_term"}}</script>

    {% if currentPage-1 > 0 %}
        <link rel="prev" href="{{ webstoreConfig.domainSsl }}?{{ query | merge({'page' : currentPage-1 }) | url_encode }}" />
    {% endif %}

    {% if currentPage+1 <= pageMax %}
        <link rel="next" href="{{ webstoreConfig.domainSsl }}?{{ query | merge({'page' : currentPage+1 }) | url_encode }}" />
    {% endif %}

    <title>{% if category.details[0].metaTitle %}{{ category.details[0].metaTitle }}{% else %}{{ category.details[0].name }}{% endif %} | {{ trans("Ceres::Template.headerCompanyName") }}</title>

    <meta name="description" content="{{ category.details[0].metaDescription }}">
    <meta name="keywords" content="{{ category.details[0].metaKeywords }}">

    <meta name="robots" content="{{ metaRobots }}">
{% endblock %}
